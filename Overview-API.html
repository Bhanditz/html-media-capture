<!DOCTYPE html>
<html>
  <head>
    <title>The Media Capture API</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <script src='../ReSpec.js/js/respec.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "ED",
          shortName:            "media-capture-api",
          editors: [{name: "Dzung D Tran", company: "Intel"},
                    {name: "Ilkka Oksanen", company: "Nokia"},
                    {name: "Ingmar Kliche", company: "Deutsche Telekom"},
                    //{name: "Dominique HazaÃ«l-Massieux", company: "W3C"}
      ],
          //publishDate:  "2010-04-01",
          // previousPublishDate:  "1977-03-15",
          edDraftURI:           "http://dev.w3.org/2009/dap/camera/",
          // lcEnd: "2009-08-05",
      };
    </script>
    <script src='../common/config.js' class='remove'></script>
  </head>
  <body>
  
    <section id='abstract'>
      This specification defines an Application Programming Interface
      (<acronym title="Application Programming Interface">API</acronym>)
      that provides access to the audio, image and video capture
      capabilities of the device.  
    </section>

    <section id="sotd">
      <p>This document represents the early consensus of the group on
      the scope and features of the proposed Capture
      API. Issues and editors notes in the document highlight some of
      the points on which the group is still working and would
      particularly like to get feedback.</p>
    </section>

    <section>
    <h2>Introduction</h2>

    <p>The Capture API defines a high-level interface for accessing the
    microphone and camera of a hosting device. It completes the HTML Form Based Media Capturing specification [[!HTMLMEDIACAPTURE]] with a programmatic access to start a parametrized capture process.</p>

      <section id="examples">
      <h2>Usage Examples</h2>

        <p>The following code extracts illustrate how to work with a
        camera service in the hosting device:</p>

	<div>
	<p>Launching a device camera application and retrieving the
	pictures taken. </p>

        <pre class="example sh_javascript_dom">

function success(data) {
  var container = document.createElement(&quot;div&quot;);
  
  for (var i in data) {
    var img = document.createElement(&quot;img&quot;);
    img.src = data[i].url;
    container.appendChild(img);
  }
  document.body.appendChild(container);

}
 
function error(err) {
  if (err.code === err.CAPTURE_INTERNAL_ERR) {
    alert("The capture failed due to an internal error");
  }

}
 
navigator.device.captureImage(success, error, { maxNumberOfMediaFiles: 1 });

        </pre>
        </div>
        <div>	

	<p>Example of retrieving image sizes and formats supported by hosting
        device camera.</p>

	<pre class="example sh_javascript_dom">var summary;

formats = navigator.device.supportedImageFormats;

for (var key in formats) {
  summary &#43;= key &#43; &quot;: &quot; &#43; formats[key] &#43; &quot;\n&quot;;
}

alert(summary);

        </pre>
        </div>

      </section>
    </section>

    <section id="security">
    <h2>Security and Privacy Considerations</h2>

    <p class='note'>
    <strong>The overall architecture for addressing privacy in DAP is still  
    under construction. As it is finalized, there may be changes made to  
    this API to reflect requirements or support for privacy-related  
    functionality.</strong>
    </p>   

    <p>The API defined in this specification launches the capture
    application which allows the user to take pictures, record voice or
    record video and provides a handle to the content. This information
    can potentially compromise user privacy and a conforming
    implementation of this specification MUST provide a mechanism that
    protects the user's privacy and this mechanism should ensure that such
    operations MUST NOT happen without user consent.</p>

    <h3>Privacy considerations for implementers of Capture API</h3>

    <p>A conforming implementation of this specification MUST provide a
    mechanism that protects the user's privacy and this mechanism SHOULD
    ensure that privacy information is not revealed without user's
    informed consent.</p>

    <p class='note'>
    <strong>Note that there is a minimization issue with EXIF headers. 
    Implementations MUST not embed information in the EXIF header which 
    could be used for non-intended purposes (such as geolocation or device id).
    </strong>
    </p>   

    </section>

    <section id="api">
    <h2>API Description</h2>

      <section>
      <h3><a>Capture</a> interface</h3>

      <p>The <code>Capture</code> interface exposes an interface to the
      camera and microphone of the hosting device.</p>

      <p>Objects implementing the <code>NavigatorDevice</code>
      interface (e.g. the <code>window.navigator.device</code> object
      in Web browsers [[NAVIGATOR]]) provide access to the
      <code>Capture</code> interface through the <code>Capture</code>
      interface. An instance of <code>Capture</code> would be then
      obtained by using binding-specific casting methods on an
      instance of <code>NavigatorDevice</code>.</p>

    <p class='note'>
    The MediaFileData Interface contains a duration attribute. What does it mean here? Is it the max recording length?.
    </p>   


      <dl title="[Supplemental, NoInterfaceObject] interface Capture"
      class="idl"><dt>readonly attribute MediaFileData[]
      supportedImageFormats</dt>

      <dd>An array of MediaFileData [[!HTMLMEDIACAPTURE]] objects which contains image sizes
      and formats supported by the hosting device camera.</dd>

      <dt>readonly attribute MediaFileData[]
      supportedVideoFormats </dt>
      <dd>An array of MediaFileData [[!HTMLMEDIACAPTURE]] objects which contains video
      resolutions and formats supported by the hosting device
      camera.</dd>

      <dt>readonly attribute MediaFileData[]
      supportedAudioFormats</dt>
      <dd>An array of MediaFileData [[!HTMLMEDIACAPTURE]] objects which contains audio
      formats supported by the hosting device microphone.</dd>

      <dt>PendingOperation captureImage () </dt>
      <dd><p>Launch device native camera application for taking
      image(s).</p>

      <p>This method takes two or three arguments. When called, it
      immediately returns a <a
      href="#pendingoperation"><code>PendingOperation</code></a>
      object and then asynchronously start a <em>capture image</em>
      process defined as follows:</p>

      <p></p>

      <ol>

      <li>Start native camera application. Allow end user to take
      picture(s).</li>

      <li>If successful, invoke the associated <code>successCB</code>
      with a <code>FileList</code> [[!FILE-API]]</a>
      argument. If the attempt fails, and the method was invoked with a
      non-null <code>errorCallback</code> argument, this method must
      invoke the <code>errorCallback</code> with a <a
      href="#captureerror"><code>CaptureError</code></a> object
      as an argument.</li>

      <li>If a <code>CaptureImageOptions</code> parameter was present,
      and its <code>maxNumberOfMediaFiles</code> attribute was defined,
      <code>successCB</code> MUST be invoked after the user has
      captured a number of images defined in <code>maxNumberOfMediaFiles</code>.  If
      user exited the native camera application prematurely,
      <code>errorCB</code> must be invoked.</li> </ol>
      
      <p></p>

      <dl class="parameters">
        <dt>CaptureCB successCB </dt>
        <dd>Function to call when the asynchronous operation completes </dd>

        <dt>optional CaptureErrorCB errorCB </dt>
        <dd>Function to call when the asynchronous operation
        fails. This parameter is OPTIONAL.</dd>

        <dt>optional CaptureImageOptions options </dt>
        <dd>Image capture options. This parameter is OPTIONAL.</dd>
      </dl>	
    
      </dd>
      
      <dt>PendingOperation captureVideo ()</dt>

      <dd>

      <p>Launch device native camera application for recording
      video(s).</p>

      <p>This method takes three or four arguments. When called, it
      immediately returns a <a
      href="#pendingoperation"><code>PendingOperation</code></a>
      object and then asynchronously start a <em>capture video</em> process
      defined as follows:</p>

      <p></p>

      <ol>

      <li>Start native video camera application. Allow end user to
      take video(s) and return.  </li><li>If successful, invoke the
      associated <code>successCB</code> with a <code>FileList</code> 
      [[!FILE-API]] argument. If
      the attempt fails, and the method was invoked with a non-null
      <code>errorCallback</code> argument, this method must invoke the
      <code>errorCallback</code> with a <a
      href="#captureerror"><code>CaptureError</code></a> object as
      an argument.</li>

      <li>If a <code>CaptureVideoOptions</code> parameter was present, and
      its <code>maxNumberOfMediaFiles</code> attribute was defined,
      <code>successCB</code> MUST be invoked after the user has
      captured a number of video clips defined in
      <code>maxNumberOfMediaFiles</code>.  If user exited the native camera
      application prematurely, <code>errorCB</code> must be invoked.</li>

      <li>If a <code>CaptureVideoOptions</code> parameter was present,
      and its <code>duration</code> attribute was defined,
      <code>successCB</code> MUST be invoked after the video has
      been captured for the number of seconds defined in
      <code>duration</code>.  If user exited the native camera
      application prematurely, <code>errorCB</code> must be invoked.
      </li>

      </ol> 

      <p></p>

      <dl class="parameters">
        <dt>CaptureCB successCB </dt>
	<dd>Function to call when the asynchronous operation completes </dd>

	<dt>optional CaptureErrorCB errorCB</dt>
	<dd>Function to call when the asynchronous operation fails. This
	parameter is OPTIONAL.</dd>

	<dt>optional CaptureVideoOptions options </dt>
	<dd>Image capture options. This parameter is OPTIONAL.</dd>
      </dl>

      </dd>
      <dt>PendingOperation captureAudio () </dt>

      <dd><p>Launch device native audio recorder application for
      recording audio clip(s).</p>
      
      <p>This method takes two or three arguments. When called, it
      immediately returns a <a href="#pendingoperation">
      <code>PendingOperation</code></a> object and then asynchronously
      start a <em>capture audio</em> process defined as follows:</p>

      <p></p>

      <ol>

      <li>Start native audio recorder application. Allow end user to record
      audio clip(s) and return.</li>

      <li>If successful, invoke the associated <code>successCB</code>
      with a <code>FileList</code> [[!FILE-API]] 
      argument. If the attempt fails, and the method was invoked with a
      non-null <code>errorCallback</code> argument, this method must invoke
      the <code>errorCallback</code> with a <a
      href="#captureerror"><code>CaptureError</code></a> object as
      an argument.</li>

      <li>If a <code>CaptureAudioOptions</code> parameter was present,
      and its <code>maxNumberOfMediaFiles</code> attribute was defined,
      <code>successCB</code> MUST be invoked after the user has
      captured a number of audio clips defined in
      <code>maxNumberOfMediaFiles</code>.  If user exited the native audio recorder
      application prematurely, <code>errorCB</code> must be invoked.
      </li> 

      </ol>

      <p></p>

      <dl class="parameters">
        <dt>CaptureCB successCB </dt>
	<dd>Function to call when the asynchronous operation completes </dd>

	<dt>optional CaptureErrorCB errorCB </dt>
	<dd>Function to call when the asynchronous operation fails. This
	parameter is OPTIONAL.</dd>

	<dt>optional CaptureAudioOptions options </dt>
	<dd>Audio capture options. This parameter is OPTIONAL.</dd>
      </dl>
      </dd>

      </dl>
    </section>

    <section id="capturecallback"><h3><a>CaptureCB</a> interface</h3>

    <dl title="[Callback=FunctionOnly, NoInterfaceObject] interface CaptureCB" class="idl">
      <dt>void onSuccess () </dt><dd>
      <dl class="parameters"><dt>FileList capturedMedia </dt><dd>Sequence
      of Files [[!FILE-API]] (implementing the MediaFile [[!HTMLMEDIACAPTURE]] interface) successfully captured by the device</dd>
    </dd></dl>
    </dd></dl>

    </section>

    <section  id="errorcallback"><h3><a>CaptureErrorCB</a> interface</h3>
    <dl title="[Callback=FunctionOnly, NoInterfaceObject] interface CaptureErrorCB" class="idl">
      <dt>void onError () </dt><dd>
      <dl class="parameters"><dt>CaptureError error </dt><dd>The error
      object of an unsuccessful capture asynchronous operation. </dd></dl>
    </dd></dl>
    
    </section>

    <section id="captureerror"><h3><a>CaptureError</a> interface</h3>

    <p>The <a>CaptureError</a> interface encapsulates all errors in the
    Capture API. </p>

    <p class="note">More error codes to be defined here. </p>

    <dl title="[NoInterfaceObject] interface CaptureError" class="idl">
      <dt>const unsigned short CAPTURE_INTERNAL_ERR = 0 </dt>
      <dd>Camera or microphone failed to capture image or sound. </dd>
      <dt>readonly attribute unsigned short code </dt>
      <dd>An error code assigned by an implementation when an error has
      occurred in Capture API processing.</dd>
    </dl>
  
    </section>

    <section id="captureimageoptions"><h3><a>CaptureImageOptions</a> interface</h3>

    <p>The <a>CaptureImageOptions</a> interface encapsulates all image
    capture operation configuration options.</p>

    <p class="note">Additional attributes proposed: <code>width</code>
    and <code>height</code>.</p>
    <p class="note">We might want to add <code>format</code> to give author control 
    over the capture format.</p>

    <dl title="[NoInterfaceObject] interface CaptureImageOptions" class="idl">
      <dt>attribute unsigned long maxNumberOfMediaFiles</dt>
      <dd>Upper limit of images user can take.</dd>
    </dl>

    </section>

    <section id="capturevideooptions"><h3><a>CaptureVideoOptions</a> interface</h3>

    <p class="note">We might want to add <code>format</code> to give author control 
    over the capture format.</p>

    <dl title="[NoInterfaceObject] interface CaptureVideoOptions" class="idl">
      <dt>attribute unsigned long maxNumberOfMediaFiles</dt>
      <dd>Upper limit of videos user can record.</dd>
      <dt>attribute float duration</dt>
      <dd>Maximum duration of a single video clip in seconds.</dd>
    </dl>

    </section>

    <section id="captureaudiooptions"><h3><a>CaptureAudioOptions</a> interface</h3>
    <p class="note">Additional attributes proposed: <code>duration</code>.</p>
    <p class="note">We might want to add <code>format</code> to give author control 
    over the capture format.</p>

    <dl title="[NoInterfaceObject] interface CaptureAudioOptions" class="idl">
      <dt>attribute unsigned long maxNumberOfMediaFiles</dt>
      <dd>Upper limit of sound clips user can record.</dd>
    </dl>

    </section>

  <section id="pendingoperation"><h3><a>PendingOperation</a> interface</h3>

  <p class="note">This may be a general interface for use throughout
  all APIs. Included here for now for completion.</p>

  <dl title="[NoInterfaceObject] interface PendingOperation" class="idl">
    <dt>void cancel ()</dt>
    <dd>Cancel/clear the pending asynchronous operation. </dd>
  </dl>

  </section>
  </section>

<section class='appendix' id="related">
<h2>Related documents</h2>
<p>The API described in this document took inspiration from the following documents:</p>
<ul>
<li><a href="http://code.google.com/p/gears/wiki/CameraAPI">Google Camera API</a>
</li><li><a href="http://bondi.omtp.org/1.0/apis/camera.html">BONDI 1.1 camera API</a>
</li><li><a href="http://lists.w3.org/Archives/Public/public-device-apis/2009Apr/att-0001/camera.html">Nokia Camera API</a>
</li></ul>
</section>

<section class='appendix' id="ack">
<h2>Acknowledgements</h2>

<p>Many thanks to Google, Nokia, and OMTP BONDI who provided the
initial input into this specification.

</p>
</section>
</body>
</html>
