<!DOCTYPE html>
<html>
  <head>
    <title>The Media Capture API - level 2 placeholder</title>
    <meta http-equiv='Content-Type' content='text/html;charset=utf-8'/>
    <script src='../ReSpec.js/js/respec.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "unofficial",
          shortName:            "capture-level-2",
          editors: [{name: "Dzung D Tran", company: "Intel"},
                    {name: "Ilkka Oksanen", company: "Nokia"},
                    {name: "Ingmar Kliche", company: "Deutsche Telekom"},
                    //{name: "Dominique HazaÃ«l-Massieux", company: "W3C"}
      ],
          // publishDate:  "2009-08-06",
          // previousPublishDate:  "1977-03-15",
          // edDraftURI:           "http://dev.w3.org/2009/dap/camera-req/",
          // lcEnd: "2009-08-05",
      };
    </script>
    <script src='../common/config.js' class='remove'></script>
  </head>
  <body>
    <section id="abstract">
      <p>This is a temporary document for storing potential specification text for level 2 of Media Capture API.</p> 
    </section>

  <section id="viewfinder-interface">
  <h3><a>ViewFinder</a> interface</h3>

  <p>This interface represents a camera viewfinder. It inherits from
  <code>File</code> [[FILE-API]] and provides a method to embed a
  viewfinder to web content.</p>

  <dl title='[NoInterfaceObject] interface ViewFinder : File' class='idl'>

  <dt>void startCapture ()</dt>
  <dd>
    <p>
      Starts the capture process.
    </p>
    <dl class='parameters'>
      <dt>Blob data</dt>
      <dd>
        The blob to write.
      </dd>
    </dl>
  </dd>
  <dt>void stopCapture ()</dt>
  <dd>
    <p>
      Stops the capture process.
    </p>
  </dd>

  </dl>

      <dt>PendingOperation getViewFinder () </dt>
      <dd>

      <p>This method takes one or two arguments. When called, it
      immediately returns a <a
      href="#pendingoperation"><code>PendingOperation</code></a>
      object and then tries asynchronously to return the ViewFinder object of the
      active capture device selected by the system or user.</p>
      
      <p class='note'>User consent must be verified.</p>   

      <p>If successful, invokes the associated <code>ViewFinderCB</code>
      with a <a href="#viewfinder-interface"> <code>ViewFinder</code></a>
      argument. If the attempt fails, and the method was invoked with a
      non-null <code>errorCallback</code> argument, this method must invoke
      the <code>errorCB</code> with a <a
      href="#captureerror"><code>CaptureError</code></a> object as
      an argument.</p>

      <dl class="parameters">
        <dt>ViewFinderCB successCB </dt>
        <dd>Function to call when the asynchronous operation completes </dd>

        <dt>optional ViewFinderErrorCB? errorCB </dt>
        <dd>Function to call when the asynchronous operation
        fails. This parameter is OPTIONAL.</dd>
      </dl>	
      </dd>
      </dl>

  </section>


    <section  id="viewfindercallback"><h3><a>ViewFinderCB</a> interface</h3>
    <dl title="[Callback=FunctionOnly, NoInterfaceObject] interface ViewFinderCB" class="idl">
      <dt>void onSuccess () </dt><dd>
      <dl class="parameters"><dt>ViewFinder viewfinder </dt><dd>The
      ViewFinder object of the selected capture device.</dd></dl>
    </dd></dl>
    
    </section>

    <section  id="viewfindererrorcallback"><h3><a>ViewFinderErrorCB</a> interface</h3>
    <dl title="[Callback=FunctionOnly, NoInterfaceObject] interface ViewFinderErrorCB" class="idl">
      <dt>void onError () </dt><dd>
      <dl class="parameters"><dt>CaptureError error</dt><dd> The error
      object of an unsuccessful asynchronous viewfinder acquisition operation. </dd></dl>
      </dd></dl>
    </section>


<section id="viewfinder">
<h2>ViewFinder aware file-select control</h2>

<p>Conforming user agents MUST provide the user a file picker from
which it is possible to select any of the available capture devices in
addition to possibility to select one or more files from the file
system.</p>

<p>If a user selects camera device, the <code>FileList</code> object
that represents the currently selected files in the input element in
the File Upload state MUST contain one <code>ViewFinder</code>
object instead of <code>File</code> objects as in [[FILE-API]].</p>

<pre class="example example sh_javascript_dom">
    &lt;script&gt;

      function getVideo () {
        var inp = document.createElement("input");
        inp.type = "file";
        inp.accept = "video/*";
        inp.onchange = function () { setupVideo(this.files[0]); };
        // this is only possible in trusted environments
        // the click event cannot be synthetized by default
        inp.click();
      }

      var blob;

      function setupVideo (vf) {
        document.getElementById("my-video").src = vf.URL;
	var bb = new BlobBuilder();
        blob = bb.getBlob();
        document.getElementById("start").onclick = function () { vf.startCapture(bb.getBlob()); }
        document.getElementById("stop").onclick = function () { vf.stopCapture(); }
        document.getElementById("send").onclick = function () { send(); }
      }

      function send () {
        if (!blob) {
           alert("You didn't capture anything!")
           return;
        }
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "http://my-server/video-upload");
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 &amp;&amp; xhr.status == 200) alert("Video uploaded!");
        }
        xhr.send(blob);
      }
    &lt;/script&gt;

    &lt;button onclick='getVideo();'&gt;Film your face!&lt;/button&gt;
    &lt;video id='my-video'&gt;&lt;/video&gt;
    &lt;button id='start'&gt;Start&lt;/button&gt;
    &lt;button id='stop'&gt;Stop&lt;/button&gt;
    &lt;button id='send'&gt;Upload&lt;/button&gt;
</pre>

</section>


    <!--************************************* /Requirements ******************************************-->
  </body>
</html>
